<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>NostraJAMus</title>

    <!-- Bootstrap Core CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="/static/css/agency.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.css"/>

    <!-- Custom Fonts -->
    <link href="/static/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>

    <script src="http://connect.soundcloud.com/sdk.js"></script>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->


    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-58603725-1', 'auto');
        ga('send', 'pageview');
    </script>
</head>

<body id="page-top" class="index">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand page-scroll" href="/">NostraJAMus</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="hidden">
                        <a href="#page-top"></a>
                    </li>
{#                    <li class="active">#}
{#                        <a class="page-scroll" href="#services">Contests</a>#}
{#                    </li>#}
{#                    <li>#}
{#                        <a class="page-scroll" href="#portfolio">Trending Jams</a>#}
{#                    </li>#}
{#                    <li>#}
{#                        <a class="page-scroll" href="#team">Team</a>#}
{#                    </li>#}
{#                    <li>#}
{#                        <a class="page-scroll" href="#contact">Contact</a>#}
{#                    </li>#}
                    <li>
                        {% if user.is_authenticated %}
                            <a href="/logout/">Logout</a>
                        {% else %}
                            <a href="/login/">Login</a>
                        {% endif %}
                    </li>
{#                    <li>#}
{#                        <button type="button" class="btn btn-success" href="">Add Funds</button>#}
{#                    </li>#}
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>

    <!-- Header -->
    <header>
        <div class="container">
            <div class="intro-text">
                {% if user.isAuthenticated %}
                    <div class="intro-lead-in">Welcome To The</div>
                    <div class="intro-heading">2015 Kick Off Contest</div>
                {% else %}
                    <div class="intro-lead-in">Nostrajamus</div>
                    <div class="intro-heading">Enter contests. Champion songs. Win big.</div>
                {% endif %}
                <a href="#track-section" class="btn btn-circle page-scroll">
                    <i class="fa fa-angle-double-down animated"></i>
                </a>
            </div>
        </div>
    </header>

    {% if user.is_authenticated %}
    <section id="track-section">
        <div id="my-song">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12 text-center">
                        <h2 class="section-heading">Your Track</h2>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-2">
                        <div class="rank-holder text-center">
                            <h3 class="rank">Place: {{ my_rank }}</h3> <h5>out of {{ track_count }}</h5>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <iframe width="100%" height="166" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/{{ my_track.track.sc_id }}&amp;color=ff3333&amp;auto_play=false&amp;hide_related=false&amp;show_comments=true&amp;show_user=true&amp;show_reposts=false"></iframe>
                    </div>
                    <div class="col-md-2 rank-holder">
                        <div>{{ my_track.jam_points }} Jam Points</div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    {% endif %}

    <section id="choose-song-section" class="bg-light-gray">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2 class="section-heading">Choose Our Next Contest</h2>
                    <div class="intro-lead-in">e.g. East Coast vs. West Coast Rap or Best Acoustic Cover</div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <form name="chooseContestForm" id="chooseContestForm">
                        <div class="row">
                            <div class="col-md-8 col-md-offset-2">
                                <div class="form-group">
                                    <input type="text" name="idea" class="form-control" placeholder="What do you think?" id="contest_idea">
                                    <p class="help-block text-danger"></p>
                                </div>
                            </div>
                            <div class="clear-fix"></div>
                            <div class="col-md-12 text-center">
                                <div id="success"></div>
                                <button type="submit" class="btn btn-primary">Submit</button>
                                <div id="errors"></div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <section id="contest-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2 class="section-heading">Current Rankings</h2>
                    <a href="https://soundcloud.com/nostrajamus/sets/2015-kickoff-contest" target="_blank">Listen to this playlist on Soundcloud!</a>
                </div>
            </div>
            <br/>
            <br/>
            {% include "entry_index_page.html" %}

        </div>

    </section>


    <!-- Modal -->
    <div class="modal fade" id="graphModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel"></h4>
                </div>
{#                <div class="container">#}

                    <div class="row text-center">
                        <div class="col-md-12">
                            <img width="200" height="200" src="" id="album_art" alt=""/>
                        </div>
                    </div>
                    <div class="row text-center">
                        <div class="col-md-4">
                            <h5>Initial Playcount</h5>
                            <p id="ip"></p>
                        </div>
                        <div class="col-md-4">
                            <br/>
                            <h4 class="green" id="percentage"></h4>
                        </div>
                        <div class="col-md-4">
                            <h5>Current Playcount</h5>
                            <p id="cp"></p>
                        </div>
                    </div>
                    <div class="row text-center">
                        <div class="col-md-12">
                            <h5>Followers</h5>
                            <p id="fc">20000</p>
                        </div>

                    </div>
{#                </div>#}
{#                <div class="modal-body" id="chart-modal-body">#}

{#                </div>#}
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" id="closeModalBtn" data-dismiss="modal">Sweet.</button>
                </div>
            </div>
        </div>
    </div>



{#            <div class="row">#}
{#                <div class="col-md-4 col-sm-6 portfolio-item">#}
{#                    <a href="#portfolioModal1" class="portfolio-link" data-toggle="modal">#}
{#                        <div class="portfolio-hover">#}
{#                            <div class="portfolio-hover-content">#}
{#                                <i class="fa fa-plus fa-3x"></i>#}
{#                            </div>#}
{#                        </div>#}
{#                        <img src="/static/img/portfolio/roundicons.png" class="img-responsive" alt="">#}
{#                    </a>#}
{#                    <div class="portfolio-caption">#}
{#                        <h4>Round Icons</h4>#}
{#                        <p class="text-muted">Graphic Design</p>#}
{#                    </div>#}
{#                </div>#}
{#                <div class="col-md-4 col-sm-6 portfolio-item">#}
{#                    <a href="#portfolioModal2" class="portfolio-link" data-toggle="modal">#}
{#                        <div class="portfolio-hover">#}
{#                            <div class="portfolio-hover-content">#}
{#                                <i class="fa fa-plus fa-3x"></i>#}
{#                            </div>#}
{#                        </div>#}
{#                        <img src="/static/img/portfolio/startup-framework.png" class="img-responsive" alt="">#}
{#                    </a>#}
{#                    <div class="portfolio-caption">#}
{#                        <h4>Startup Framework</h4>#}
{#                        <p class="text-muted">Website Design</p>#}
{#                    </div>#}
{#                </div>#}
{#                <div class="col-md-4 col-sm-6 portfolio-item">#}
{#                    <a href="#portfolioModal3" class="portfolio-link" data-toggle="modal">#}
{#                        <div class="portfolio-hover">#}
{#                            <div class="portfolio-hover-content">#}
{#                                <i class="fa fa-plus fa-3x"></i>#}
{#                            </div>#}
{#                        </div>#}
{#                        <img src="/static/img/portfolio/treehouse.png" class="img-responsive" alt="">#}
{#                    </a>#}
{#                    <div class="portfolio-caption">#}
{#                        <h4>Treehouse</h4>#}
{#                        <p class="text-muted">Website Design</p>#}
{#                    </div>#}
{#                </div>#}
{#                <div class="col-md-4 col-sm-6 portfolio-item">#}
{#                    <a href="#portfolioModal4" class="portfolio-link" data-toggle="modal">#}
{#                        <div class="portfolio-hover">#}
{#                            <div class="portfolio-hover-content">#}
{#                                <i class="fa fa-plus fa-3x"></i>#}
{#                            </div>#}
{#                        </div>#}
{#                        <img src="/static/img/portfolio/golden.png" class="img-responsive" alt="">#}
{#                    </a>#}
{#                    <div class="portfolio-caption">#}
{#                        <h4>Golden</h4>#}
{#                        <p class="text-muted">Website Design</p>#}
{#                    </div>#}
{#                </div>#}
{#                <div class="col-md-4 col-sm-6 portfolio-item">#}
{#                    <a href="#portfolioModal5" class="portfolio-link" data-toggle="modal">#}
{#                        <div class="portfolio-hover">#}
{#                            <div class="portfolio-hover-content">#}
{#                                <i class="fa fa-plus fa-3x"></i>#}
{#                            </div>#}
{#                        </div>#}
{#                        <img src="/static/img/portfolio/escape.png" class="img-responsive" alt="">#}
{#                    </a>#}
{#                    <div class="portfolio-caption">#}
{#                        <h4>Escape</h4>#}
{#                        <p class="text-muted">Website Design</p>#}
{#                    </div>#}
{#                </div>#}
{#                <div class="col-md-4 col-sm-6 portfolio-item">#}
{#                    <a href="#portfolioModal6" class="portfolio-link" data-toggle="modal">#}
{#                        <div class="portfolio-hover">#}
{#                            <div class="portfolio-hover-content">#}
{#                                <i class="fa fa-plus fa-3x"></i>#}
{#                            </div>#}
{#                        </div>#}
{#                        <img src="/static/img/portfolio/dreams.png" class="img-responsive" alt="">#}
{#                    </a>#}
{#                    <div class="portfolio-caption">#}
{#                        <h4>Dreams</h4>#}
{#                        <p class="text-muted">Website Design</p>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}

        </div>
    </section>

{#    <section id="contact">#}
{#        <div class="container">#}
{#            <div class="row">#}
{#                <div class="col-lg-12 text-center">#}
{#                    <h2 class="section-heading">Contact Us</h2>#}
{#                    <h3 class="section-subheading text-muted">We would love to hear your feedback!gi</h3>#}
{#                </div>#}
{#            </div>#}
{#            <div class="row">#}
{#                <div class="col-lg-12">#}
{#                    <form name="sentMessage" id="contactForm" novalidate>#}
{#                        <div class="row">#}
{#                            <div class="col-md-6">#}
{#                                <div class="form-group">#}
{#                                    <input type="text" class="form-control" placeholder="Your Name *" id="name" required data-validation-required-message="Please enter your name.">#}
{#                                    <p class="help-block text-danger"></p>#}
{#                                </div>#}
{#                                <div class="form-group">#}
{#                                    <input type="email" class="form-control" placeholder="Your Email *" id="email" required data-validation-required-message="Please enter your email address.">#}
{#                                    <p class="help-block text-danger"></p>#}
{#                                </div>#}
{#                                <div class="form-group">#}
{#                                    <input type="tel" class="form-control" placeholder="Your Phone *" id="phone" required data-validation-required-message="Please enter your phone number.">#}
{#                                    <p class="help-block text-danger"></p>#}
{#                                </div>#}
{#                            </div>#}
{#                            <div class="col-md-6">#}
{#                                <div class="form-group">#}
{#                                    <textarea class="form-control" placeholder="Your Message *" id="message" required data-validation-required-message="Please enter a message."></textarea>#}
{#                                    <p class="help-block text-danger"></p>#}
{#                                </div>#}
{#                            </div>#}
{#                            <div class="clearfix"></div>#}
{#                            <div class="col-lg-12 text-center">#}
{#                                <div id="success"></div>#}
{#                                <button type="submit" class="btn btn-xl">Send Message</button>#}
{#                            </div>#}
{#                        </div>#}
{#                    </form>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{#    </section>#}

    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <span class="copyright">Copyright &copy; NostraJAMus 2015</span>
                </div>
                <div class="col-md-4">
                    <ul class="list-inline social-buttons">
                        <li><a href="#"><i class="fa fa-twitter"></i></a>
                        </li>
                        <li><a href="#"><i class="fa fa-facebook"></i></a>
                        </li>
                        <li><a href="#"><i class="fa fa-linkedin"></i></a>
                        </li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <ul class="list-inline quicklinks">
                        <li><a href="#">Privacy Policy</a>
                        </li>
                        <li><a href="#">Terms of Use</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>


    <!-- jQuery -->
    <script src="/static/js/jquery.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src="/static/js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
    <script src="/static/js/classie.js"></script>
    <script src="/static/js/cbpAnimatedHeader.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.1/Chart.min.js"></script>

    <script src="/static/js/jqBootstrapValidation.js"></script>
{#    <script src="/static/js/contact_me.js"></script>#}

{#    <script src="http://code.jquery.com/jquery-latest.js"></script>#}
    <script src="/static/js/endless-pagination.js"></script>

    <script src="/static/js/agency.js"></script>
    <script type="text/javascript" src="/static/js/nostrajamus.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.1/Chart.min.js"></script>
    <script type="text/javascript">
{#        var my_ctx = document.getElementById("trackChart").getContext("2d");#}
{#        var myChart = new Chart(my_ctx).Line({});#}

        $.ajaxSetup({
             beforeSend: function(xhr, settings) {
                 function getCookie(name) {
                     var cookieValue = null;
                     if (document.cookie && document.cookie != '') {
                         var cookies = document.cookie.split(';');
                         for (var i = 0; i < cookies.length; i++) {
                             var cookie = jQuery.trim(cookies[i]);
                             // Does this cookie string begin with the name we want?
                         if (cookie.substring(0, name.length + 1) == (name + '=')) {
                             cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                             break;
                         }
                     }
                 }
                 return cookieValue;
                 }
                 if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
                     // Only send the token to relative URLs i.e. locally.
                     xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
                 }
             }
        });

        $.endlessPaginate({
            paginateOnScroll: true,
            paginateOnScrollMargin: 20
        });

        function updateGraph(id, callback) {
            $.ajax({
                type: 'GET',
                url: '/api/tracks/'+id+'/playcounts/',
                success: function (data) {
                    console.log("Success");
                    console.log(data);
                    var playbacks = {};
                    var followers = {};
{#                    var labels = [];#}
                    for (var i = 0; i < data.length; i++) {

                        var periodic_pc = data[i];
                        var date = new Date(periodic_pc.created_at);
                        if (playbacks[date.toDateString()] == undefined) {
                            playbacks[date.toDateString()] = []
                        }
                        if (followers[date.toDateString()] == undefined) {
                            followers[date.toDateString()] = []
                        }
                        console.log(date.toDateString());
                        playbacks[date.toDateString()].push(periodic_pc.playback_count);
                        followers[date.toDateString()].push(periodic_pc.follower_count);
{#                        labels.push(date.getDate());#}
                    }
                    var plays_by_day = {};
                    for (key in playbacks) {
                        var plays = playbacks[key];
                        var avg = 0;
                        for (var i = 0; i < plays.length; i++) {
                            avg += plays[i];
                        }
                        plays_by_day[key] = (avg / plays.length);
                    }

                    var followers_by_day = {};
                    for (key in followers) {
                        var follows = followers[key];
                        var avg = 0;
                        for (var i = 0; i < follows.length; i++) {
                            avg += follows[i];
                        }
                        followers_by_day[key] = (avg / follows.length);
                    }

                    var plays_set = [],
                            labels = [],
                            follow_set = [];
                    for (key in plays_by_day) {
                        plays_set.push(plays_by_day[key]);
                        var label = key.split(" ");
                        labels.push(label[1] + " " + label[2] + " " + label[3]);
                    }
                    for (key in followers_by_day) {
                        follow_set.push(followers_by_day[key]);
                    }


                    var data = {
                        labels: labels,
                        datasets: [
                            {
                                label: "Artist Followers",
                                fillColor: "rgba(220,220,220,0.2)",
                                strokeColor: "rgba(220,220,220,1)",
                                pointColor: "rgba(220,220,220,1)",
                                pointStrokeColor: "#fff",
                                pointHighlightFill: "#fff",
                                pointHighlightStroke: "rgba(220,220,220,1)",
                                data: follow_set
                            },
                            {
                                label: "Track Playcount",
                                fillColor: "rgba(151,187,205,0.2)",
                                strokeColor: "rgba(151,187,205,1)",
                                pointColor: "rgba(151,187,205,1)",
                                pointStrokeColor: "#fff",
                                pointHighlightFill: "#fff",
                                pointHighlightStroke: "rgba(151,187,205,1)",
                                data: plays_set
                            }
                        ]
                    };
                    callback(data);
                },
                error: function (data) {
                    console.log(error);
                }
            });
        }

        var myChart;
        $('#graphModal').on('show.bs.modal', function (event) {
          var button = $(event.relatedTarget); // Button that triggered the modal
          var track_id = button.data('id'); // Extract info from data-* attributes
          var track_sc_id = button.data('sc-id');
          var ip = button.data('ip');
          var cp = button.data('cp');
          var fc = button.data('fc');
          var album_art_url = button.data('album-art');
          var percentage = ((cp-ip)/ip)*100;
          // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
          // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
          var modal = $(this);
          SC.get('/tracks/'+track_sc_id, function(track) {
              var title = button.data('title');
            modal.find('.modal-title').text(title);
{#            modal.find('.modal-body input').val(recipient);#}
            modal.find('#ip').text(insertCommas(ip.toString()));
            modal.find("#cp").text(insertCommas(cp.toString()));
            modal.find("#fc").text(insertCommas(fc.toString()));
            modal.find("#percentage").html("+" + percentage.toFixed(1) + "%");
            $("#album_art").attr("src", album_art_url);
            updateGraph(track_id, function(data) {
{#                myChart.datasets = data.datasets;#}

{#                $("#chart-modal-body").html('<canvas id="trackChart" width="850px" height="300px"></canvas>');#}
{#                var tc = "trackChart";#}
{#                var my_ctx = document.getElementById(tc).getContext("2d");#}
{#                myChart = new Chart(my_ctx).Line(data, {#}
{#                    bezierCurve : true,#}
{#                    legendTemplate: "<ul class=\"Chart Legend\"><li><span style=\"background-color:#ff0000\">Thing</span></li></ul>"#}
{#                });#}

            });
          });
        });



        $("#closeModalBtn").click(function(event) {
            myChart.clear()
        });

        function insertCommas(s) {

            // get stuff before the dot
            var d = s.indexOf('.');
            var s2 = d === -1 ? s : s.slice(0, d);

            // insert commas every 3 digits from the right
            for (var i = s2.length - 3; i > 0; i -= 3)
              s2 = s2.slice(0, i) + ',' + s2.slice(i);

            // append fractional part
            if (d !== -1)
              s2 += s.slice(d);

            return s2;

        }

        $("#chooseContestForm").submit(function( event ) {

            $.ajax({
                type: 'POST',
                url: '/api/contest_ideas/', //http://127.0.0.1:8000/
                dataType: 'json',
                crossDomain: 'true',
                contentType: "application/json",
                data: JSON.stringify({
                    "idea": $("#contest_idea").val()
                }),
                success: function(data) {
//                                alert('data: ' + data);
                    console.log('SUCCESS: ' + data);
                    $("#contest_idea").value = '';
                    event.preventDefault();
                    alert("Thanks! We will consider your idea for our next contest.");

                },
                error: function(error) {
//                                alert(error);
                    console.log(error);
                    event.preventDefault();
                    alert("Sorry there was an issue uploading that song. It may have been an issue on our side or it may help to clear your cookies and try again.")

                }
            });

        });

        var iframeElement   = document.querySelector('#iframe');
        var iframeElementID = iframeElement.id;
        var widget1         = SC.Widget(iframeElement);
        var widget2         = SC.Widget(iframeElementID);
{##}
{#        for width#}
{#        var song_ids = []#}

    </script>


</body>

</html>
